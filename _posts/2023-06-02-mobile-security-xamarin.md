---
title: Mobile Security - Fighting with Frameworks - Xamarin
author: Paolo Serra
date: 9999-01-02 10:00:00
categories: [Topic, Mobile Security]
toc: true
author: paoloserra
img_path: /images/mobile-security-fighting-with-frameworks
image:
  path: /xamarin/
---

![Device rooted/jailbroken](device_rooted.png){: .shadow .normal width="35" height="35" }    Device rooted/jailbroken
![Device](device.png){: .shadow .normal width="35" height="35" }    Device

> Change the date of this post to make it visible.
{: .prompt-danger }

## Xamarin

Xamarin, which is a Microsoft product, provides a single platform to develop one application for multiple platforms with **.NET** and **C#** – iOS and Android in most cases. As it is a framework, it likes getting us more frustrated, but how? Simply ignoring system proxy settings by default. Additionally, Microsoft has already implemented secure coding practices in the Xamarin framework. As such, applications developed with this framework inherit these security controls (uff..). This makes Xamarin–based applications arguably more secure than applications developed from scratch using traditional or no frameworks. Since Xamarin has full access to native APIs and toolkits used by both iOS and Android applications, it doesn't only save developers time in building and maintaining the application, but also help them in achieving near-native look and performance.

|                                           | Xamarin                                                    |
|:------------------------------|:-----------------------------------------|
|**Code**                             |C#    |
|**Compilation iOS**          |AOT                              |
|**Compilation Android**  |JIT/AOT                                                        |
|**UI Rendering**               |Native Design Elements                                           |
|**UI Engineering**            |Native / Code Sharing for the cost of native experience   |

### Detecting app

Android
: It is rather simple to determine whether an Android app was created with Xamarin or not. There is a lot of data inside the apk structure (**apktool** is your friend), but the directory holding the assemblies is what we need.. In fact, going there you will find certain assemblies related to the Mono engine, a free and open-source .NET Framework-compatible software framework now being led by Xamarin that can be run on many software systems.
Let's see some examples:

|Assembly             |Description                                                                   |
|:--------------------|:-----------------------------------------------------------------------------|
|*mscorlib.dll*         |Silverlight                          |
|*Mono.Android.dll*     |This assembly contains the C# bindings to the Android API                     |
|*Mono.Security.dll*    |Cryptographic APIs                    |
|*System.dll*           |Silverlight, plus types from other namespaces                          |
|*Xamarin.iOS.dll*      |This assembly contains the C# binding to the CocoaTouch API. This is only used in Unified iOS Projects |

Anyway, [here](https://docs.microsoft.com/en-us/xamarin/cross-platform/internals/available-assemblies) you can find a list of all available assemblies with their details.

In addition, the ***lib*** directory contains additional Xamarin-related references, such as native shared libraries. These are often directed to the monodroid engine, `libmonodroid.so` , and maybe some other plugins used by the developer.

iOS
: You cannot decompile an iOS application like Android. iOS apps are compiled directly to machine code, with an aggressive optimization pass that tends to destroy much of the original code's structure. To extract [continua]

### Intercepting Traffic

Since any local proxy setting is ignored by Xamarin, the only way to intercept the traffic generated by an application is setting up a VPN Server in another machine, connect the device to it (i.e OpenVPN) and enable IPtables on the remote machine to redirect all the traffic to **Burp Suite** (it can stay on the same machine or another one, it doesn't matter at all). It is not the same to achieve it on Android and iOS.

Android
: - ![](device_rooted.png){: .shadow width="35" height="35" } ![](device.png){: .shadow width="35" height="35" }  ProxyDroid is enough (so a VPN Server is not needed)
- ![](device_rooted.png){: .shadow width="35" height="35" } ![](device.png){: .shadow width="35" height="35" }  use ***Bettercap*** to set up an ARP Poisoning attack
- ![](device_rooted.png){: .shadow width="35" height="35" } ![](device.png){: .shadow width="35" height="35" }  use ***NoPE Proxy*** (Burp extension) to carry on a DNS Spoofing attack
- ![](device_rooted.png){: .shadow width="35" height="35" } ![](device.png){: .shadow width="35" height="35" }  set up an Access Point and connect the iOS device to it
- ![](device_rooted.png){: .shadow width="35" height="35" } use the `/etc/hosts`{: .filepath} file to make the target domain point to the IP address of your interception proxy.

iOS
: - ![](device_rooted.png){: .shadow width="35" height="35" } ![](device.png){: .shadow width="35" height="35" }  Follow this [guide](https://blog.nviso.eu/2020/06/12/intercepting-flutter-traffic-on-ios/), even though it is for flutter, it works well; you need to create a VPN Server. Otherwise, here another [guide](https://triskelelabs.com/intercepting-xamarin-mobile-app-traffic-2/) for Xamarin.
- ![](device_rooted.png){: .shadow width="35" height="35" } ![](device.png){: .shadow width="35" height="35" }  use ***Bettercap*** to set up an ARP Poisoning attack
- ![](device_rooted.png){: .shadow width="35" height="35" } ![](device.png){: .shadow width="35" height="35" }  use ***NoPE Proxy*** (Burp extension) to carry on a DNS Spoofing attack
- ![](device_rooted.png){: .shadow width="35" height="35" } ![](device.png){: .shadow width="35" height="35" }  set up an Access Point and connect the iOS device to it
- ![](device_rooted.png){: .shadow width="35" height="35" } use the `/etc/hosts`{: .filepath} file to make the target domain point to the IP address of your interception proxy.


### Certificate Pinning

Android
: .....

iOS
: .....

[Come dovrebbe essere implementato il pinning, quali sono le soluzioni comuni e come verificarlo(??).]

### Debugging

Android
: .....

iOS
: .....

[Come si debugga l'app]

### Reverse Engineering

Android
: .....

iOS
: .....

[Come fare la reverse]

---


## References

- [https://triskelelabs.com/intercepting-xamarin-mobile-app-traffic-2/](https://triskelelabs.com/intercepting-xamarin-mobile-app-traffic-2/)
- [https://mobile-security.gitbook.io/mobile-security-testing-guide/general-mobile-app-testing-guide/0x04f-testing-network-communication](https://mobile-security.gitbook.io/mobile-security-testing-guide/general-mobile-app-testing-guide/0x04f-testing-network-communication)
- [https://docs.microsoft.com/en-us/xamarin/cross-platform/internals/available-assemblies?context=xamarin/android](https://docs.microsoft.com/en-us/xamarin/cross-platform/internals/available-assemblies?context=xamarin/android)
- [https://www.codeguru.com/csharp/introduction-to-mono-for-android/](https://www.codeguru.com/csharp/introduction-to-mono-for-android/)

